<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AR Scanner - Compatible Version</title>
  
  <!-- –†–ê–ë–û–ß–ò–ï –í–ï–†–°–ò–ò –ö–ê–ö –í –ü–†–ò–ú–ï–†–ï -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      background: black;
      color: #0f0;
      font-family: monospace;
      overflow: hidden;
    }
    
    #startScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    
    .console {
      background: #111;
      border: 2px solid #0f0;
      padding: 30px;
      border-radius: 10px;
      max-width: 500px;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    }
    
    h1 {
      color: #0f0;
      margin-bottom: 20px;
    }
    
    #status {
      color: #0f0;
      margin: 15px 0;
      font-size: 18px;
    }
    
    button {
      background: #0f0;
      color: black;
      border: none;
      padding: 15px 40px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      margin: 20px 0;
      border-radius: 5px;
      font-family: monospace;
      transition: all 0.3s;
    }
    
    button:hover {
      background: #0ff;
      transform: scale(1.05);
    }
    
    button:disabled {
      background: #333;
      color: #666;
      cursor: not-allowed;
      transform: none;
    }
    
    #error {
      color: #f00;
      background: rgba(255, 0, 0, 0.1);
      padding: 10px;
      border-radius: 5px;
      margin-top: 15px;
      border: 1px solid #f00;
      display: none;
    }
    
    #debug {
      position: fixed;
      bottom: 10px;
      left: 10px;
      font-size: 12px;
      color: #888;
      background: rgba(0, 0, 0, 0.7);
      padding: 5px;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <div class="console">
      <h1>üß¨ AR SYSTEM</h1>
      <div id="status">Loading A-Frame 1.5.0...</div>
      <div id="details">
        A-Frame: <span id="aframe-status">‚åõ</span><br>
        MindAR: <span id="mindar-status">‚åõ</span>
      </div>
      <button id="startButton" disabled>START AR</button>
      <div id="error"></div>
      <div style="margin-top: 20px; font-size: 12px; color: #666;">
        Using compatible versions: A-Frame 1.5.0 + MindAR 1.2.5
      </div>
    </div>
  </div>
  
  <div id="debug">
    Status: <span id="debug-status">Initializing</span>
  </div>

  <!-- –ü—Ä–æ—Å—Ç–∞—è —Å—Ü–µ–Ω–∞ —Å –ø—Ä—è–º—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º MindAR –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ -->
  <a-scene id="arScene" 
           mindar-image="imageTargetSrc: targets.mind; autoStart: false;" 
           vr-mode-ui="enabled: false" 
           device-orientation-permission-ui="enabled: false"
           style="display: none;">
    
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">
      <a-gltf-model src="Ring.glb" 
                   position="0 0 0" 
                   rotation="0 0 0" 
                   scale="0.1 0.1 0.1"
                   animation="property: rotation; to: 0 360 0; loop: true; dur: 10000">
      </a-gltf-model>
    </a-entity>
    
  </a-scene>

  <script>
    console.log("=== AR System Initialization ===");
    console.log("Using A-Frame 1.5.0 + MindAR 1.2.5");
    
    const startScreen = document.getElementById('startScreen');
    const startButton = document.getElementById('startButton');
    const status = document.getElementById('status');
    const errorDiv = document.getElementById('error');
    const debugStatus = document.getElementById('debug-status');
    const arScene = document.getElementById('arScene');
    
    let aframeLoaded = false;
    let mindarLoaded = false;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –±–∏–±–ª–∏–æ—Ç–µ–∫
    function checkLibraries() {
      console.log("Checking libraries...");
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º A-Frame
      if (typeof AFRAME !== 'undefined') {
        console.log("‚úÖ A-Frame loaded, version:", AFRAME.version);
        document.getElementById('aframe-status').textContent = '‚úÖ v' + AFRAME.version;
        aframeLoaded = true;
      } else {
        console.log("‚ùå A-Frame not loaded");
        setTimeout(checkLibraries, 1000);
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º MindAR
      if (AFRAME.systems && AFRAME.systems['mindar-image-system']) {
        console.log("‚úÖ MindAR system found");
        document.getElementById('mindar-status').textContent = '‚úÖ Loaded';
        mindarLoaded = true;
        
        // –í—Å–µ –≥–æ—Ç–æ–≤–æ
        status.textContent = 'System ready! Click START AR';
        startButton.disabled = false;
        debugStatus.textContent = 'Libraries loaded';
      } else {
        console.log("‚è≥ Waiting for MindAR...");
        document.getElementById('mindar-status').textContent = '‚è≥ Loading...';
        status.textContent = 'Loading MindAR...';
        setTimeout(checkLibraries, 1000);
      }
    }
    
    // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
    setTimeout(checkLibraries, 1000);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
    startButton.addEventListener('click', function() {
      console.log("Start button clicked");
      
      startButton.disabled = true;
      startButton.textContent = 'STARTING...';
      status.textContent = 'Requesting camera access...';
      errorDiv.style.display = 'none';
      
      // –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ
      const scene = document.querySelector('a-scene');
      if (scene && scene.systems['mindar-image-system']) {
        const mindarSystem = scene.systems['mindar-image-system'];
        
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É –Ω–∞–ø—Ä—è–º—É—é –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(function(stream) {
            console.log("Camera access granted");
            stream.getTracks().forEach(track => track.stop());
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º MindAR
            mindarSystem.start();
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
            startScreen.style.display = 'none';
            arScene.style.display = 'block';
            
            console.log("AR system started!");
            debugStatus.textContent = 'AR active';
          })
          .catch(function(error) {
            console.error("Camera error:", error);
            errorDiv.textContent = 'Camera error: ' + error.message;
            errorDiv.style.display = 'block';
            startButton.disabled = false;
            startButton.textContent = 'RETRY';
          });
      } else {
        errorDiv.textContent = 'AR system not available';
        errorDiv.style.display = 'block';
        startButton.disabled = false;
        startButton.textContent = 'RETRY';
      }
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π AR
    arScene.addEventListener('arReady', function() {
      console.log("AR system ready");
    });
    
    arScene.addEventListener('arError', function(event) {
      console.error("AR Error:", event.detail.error);
      errorDiv.textContent = 'AR Error: ' + event.detail.error;
      errorDiv.style.display = 'block';
    });
    
    arScene.addEventListener('targetFound', function() {
      console.log("Target found");
      debugStatus.textContent = 'Target detected';
    });
    
    arScene.addEventListener('targetLost', function() {
      debugStatus.textContent = 'Scanning...';
    });
    
    // –ï—Å–ª–∏ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
    setTimeout(function() {
      if (!aframeLoaded || !mindarLoaded) {
        status.textContent = 'Loading timeout. Please refresh.';
        errorDiv.textContent = 'Failed to load AR libraries. Check internet connection.';
        errorDiv.style.display = 'block';
      }
    }, 10000);
  </script>
</body>
</html>