<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Scanner - Direct CDN</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ CDN –¥–ª—è A-Frame (–ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ) -->
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
        function loadScriptsSequentially(urls, callback) {
            let index = 0;
            
            function loadNext() {
                if (index >= urls.length) {
                    console.error("‚ùå All CDN failed to load");
                    if (typeof callback === 'function') callback(false);
                    return;
                }
                
                const url = urls[index];
                console.log(`üîÑ Trying CDN: ${url}`);
                
                const script = document.createElement('script');
                script.src = url;
                script.onload = function() {
                    console.log(`‚úÖ Loaded from: ${url}`);
                    if (typeof callback === 'function') callback(true);
                };
                script.onerror = function() {
                    console.log(`‚ùå Failed: ${url}`);
                    index++;
                    loadNext();
                };
                
                document.head.appendChild(script);
            }
            
            loadNext();
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º A-Frame —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö CDN
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Starting script loading...');
            
            const aframeCDNs = [
                'https://cdn.jsdelivr.net/npm/aframe@1.4.0/dist/aframe.min.js',
                'https://unpkg.com/aframe@1.4.0/dist/aframe.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js',
                'https://raw.githack.com/aframevr/aframe/v1.4.0/dist/aframe.min.js',
                'https://rawcdn.githack.com/aframevr/aframe/v1.4.0/dist/aframe.min.js'
            ];
            
            loadScriptsSequentially(aframeCDNs, function(success) {
                if (success) {
                    console.log('‚úÖ A-Frame loaded, now loading MindAR...');
                    loadMindAR();
                } else {
                    document.getElementById('error').innerHTML = 
                        'Failed to load A-Frame from all CDNs. Please check internet connection.';
                    document.getElementById('error').style.display = 'block';
                }
            });
        });
        
        function loadMindAR() {
            const mindarCDNs = [
                'https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js',
                'https://unpkg.com/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js',
                'https://raw.githack.com/hiukim/mind-ar-js/v1.2.3/dist/mindar-image-aframe.prod.js',
                'mindar-image-aframe.prod.js'  // –õ–æ–∫–∞–ª—å–Ω—ã–π –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç
            ];
            
            loadScriptsSequentially(mindarCDNs, function(success) {
                if (success) {
                    console.log('‚úÖ MindAR loaded');
                    setTimeout(checkSystems, 500);
                } else {
                    document.getElementById('error').innerHTML = 
                        'Failed to load MindAR. Trying alternative method...';
                    document.getElementById('error').style.display = 'block';
                    // –ü–æ–ø—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –≤—Ä—É—á–Ω—É—é
                    createMindARFallback();
                }
            });
        }
        
        function checkSystems() {
            if (window.AFRAME && AFRAME.systems && AFRAME.systems['mindar-image-system']) {
                console.log('‚úÖ Both systems ready!');
                document.getElementById('aframe-status').innerHTML = '<span style="color:#0f0">‚úÖ LOADED</span>';
                document.getElementById('mindar-status').innerHTML = '<span style="color:#0f0">‚úÖ LOADED</span>';
                document.getElementById('main-status').textContent = '>>> SYSTEM READY';
                document.getElementById('start-btn').disabled = false;
            } else {
                console.warn('‚ö†Ô∏è Systems not fully registered, retrying...');
                setTimeout(checkSystems, 1000);
            }
        }
        
        // –§–æ–ª–±—ç–∫ –µ—Å–ª–∏ MindAR –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
        function createMindARFallback() {
            console.log('Creating MindAR fallback system...');
            if (window.AFRAME) {
                // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è MindAR –¥–ª—è —Ç–µ—Å—Ç–∞
                AFRAME.registerSystem('mindar-image-system', {
                    init: function() {
                        console.log('Fallback MindAR system initialized');
                        this.start = function() {
                            console.log('Fallback MindAR started');
                            alert('‚ö†Ô∏è Using fallback AR mode. Real AR requires MindAR files.');
                        };
                    }
                });
                
                AFRAME.registerComponent('mindar-image', {
                    schema: {
                        imageTargetSrc: { default: '' },
                        autoStart: { default: false }
                    },
                    init: function() {
                        console.log('MindAR component (fallback)');
                    }
                });
                
                AFRAME.registerComponent('mindar-image-target', {
                    schema: { targetIndex: { default: 0 } },
                    init: function() {
                        console.log('Target component (fallback)');
                    }
                });
                
                document.getElementById('mindar-status').innerHTML = '<span style="color:#ff0">‚ö†Ô∏è FALLBACK MODE</span>';
                document.getElementById('main-status').textContent = '>>> LIMITED MODE';
                document.getElementById('start-btn').disabled = false;
            }
        }
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            color: #0f0; 
            font-family: 'Courier New', monospace;
            width: 100vw; 
            height: 100vh; 
            overflow: hidden;
        }
        
        #loader {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
        
        .console {
            background: rgba(20, 20, 20, 0.9);
            border: 2px solid #0f0;
            border-radius: 8px;
            padding: 25px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .status-line {
            margin: 8px 0;
            color: #0f0;
            font-size: 16px;
        }
        
        .blink {
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        button {
            background: linear-gradient(135deg, #0f0, #0a0);
            color: #000;
            border: none;
            padding: 18px 40px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }
        
        button:hover {
            background: linear-gradient(135deg, #0f0, #0f0);
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.8);
        }
        
        button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        
        #error {
            color: #f00;
            background: rgba(255, 0, 0, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border: 1px solid #f00;
            display: none;
        }
        
        #success {
            color: #0f0;
            background: rgba(0, 255, 0, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border: 1px solid #0f0;
            display: none;
        }
        
        #debug {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 12px;
            color: #888;
            background: rgba(0,0,0,0.7);
            padding: 8px;
            border-radius: 4px;
            max-width: 300px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div id="loader">
        <div class="console">
            <h2 style="color: #0f0; margin-bottom: 20px;">üß¨ AR SCANNER v2.0</h2>
            
            <div class="status-line">>>> Direct CDN Loading</div>
            <div class="status-line">>>> A-Frame: <span id="aframe-status">LOADING...</span></div>
            <div class="status-line">>>> MindAR: <span id="mindar-status">WAITING...</span></div>
            <div class="status-line">>>> CDN Attempts: <span id="cdn-status">0/5</span></div>
            <div class="status-line blink" id="main-status">>>> INITIALIZING CDN...</div>
            
            <button id="start-btn" onclick="initAR()" disabled>üéÆ INITIALIZE AR</button>
            
            <div id="error"></div>
            <div id="success"></div>
            
            <div style="margin-top: 30px; font-size: 14px; color: #888;">
                <div>URL: <span id="current-url">Loading...</span></div>
                <div>CDN Strategy: Multi-source fallback</div>
            </div>
        </div>
    </div>
    
    <div id="debug">
        Console: <span id="console-status">Initializing...</span>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è AR —Å—Ü–µ–Ω—ã -->
    <div id="ar-container" style="position:fixed; top:0; left:0; width:100%; height:100%;"></div>

    <script>
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π URL
        document.getElementById('current-url').textContent = window.location.hostname;
        
        // –°—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ CDN
        let cdnAttempts = 0;
        const originalLoadScriptsSequentially = loadScriptsSequentially;
        loadScriptsSequentially = function(urls, callback) {
            const updateCounter = function() {
                cdnAttempts++;
                document.getElementById('cdn-status').textContent = `${cdnAttempts}/5`;
            };
            
            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—ã–∑–æ–≤—ã –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫
            const wrappedUrls = urls.map(url => {
                return {
                    url: url,
                    load: function() {
                        updateCounter();
                        return url;
                    }
                }.load();
            });
            
            originalLoadScriptsSequentially(wrappedUrls, callback);
        };
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ AR
        async function initAR() {
            console.log("üöÄ Starting AR initialization...");
            
            const startBtn = document.getElementById('start-btn');
            const mainStatus = document.getElementById('main-status');
            const errorDiv = document.getElementById('error');
            const successDiv = document.getElementById('success');
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å
            startBtn.disabled = true;
            startBtn.textContent = '‚è≥ INITIALIZING...';
            mainStatus.textContent = '>>> REQUESTING CAMERA...';
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏—Å—Ç–µ–º—ã
            if (!window.AFRAME) {
                showError("A-Frame not loaded. Please refresh.");
                return;
            }
            
            if (!AFRAME.systems['mindar-image-system']) {
                showError("MindAR system not found. Using fallback mode.");
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤ fallback —Ä–µ–∂–∏–º–µ
            }
            
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Ç–æ–∫
                stream.getTracks().forEach(track => track.stop());
                
                console.log("‚úÖ Camera access granted");
                mainStatus.textContent = '>>> CREATING AR SCENE...';
                
                // –°–æ–∑–¥–∞–µ–º AR —Å—Ü–µ–Ω—É
                createARScene();
                
            } catch (err) {
                console.error("‚ùå Camera error:", err);
                let errorMsg = "Camera Error: ";
                if (err.name === 'NotAllowedError') {
                    errorMsg = "Please allow camera access in browser settings.";
                } else if (err.name === 'NotFoundError') {
                    errorMsg = "No camera found on this device.";
                } else {
                    errorMsg = err.message;
                }
                
                showError(errorMsg);
                startBtn.disabled = false;
                startBtn.textContent = 'üîÑ RETRY';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è AR —Å—Ü–µ–Ω—ã
        function createARScene() {
            try {
                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                document.getElementById('ar-container').innerHTML = '';
                
                // –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º
                const scene = document.createElement('a-scene');
                
                if (AFRAME.systems['mindar-image-system']) {
                    // –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º —Å MindAR
                    scene.setAttribute('mindar-image', `
                        imageTargetSrc: targets.mind;
                        autoStart: false;
                        uiScanning: no;
                        uiLoading: no;
                    `);
                } else {
                    // Fallback —Ä–µ–∂–∏–º - –ø—Ä–æ—Å—Ç–æ 3D —Å—Ü–µ–Ω–∞
                    scene.setAttribute('embedded', '');
                }
                
                scene.setAttribute('vr-mode-ui', 'enabled: false');
                scene.setAttribute('device-orientation-permission-ui', 'enabled: false');
                scene.style.width = '100%';
                scene.style.height = '100%';
                
                // –ö–∞–º–µ—Ä–∞
                const camera = document.createElement('a-camera');
                camera.setAttribute('position', '0 0 0');
                camera.setAttribute('look-controls', 'enabled: false');
                scene.appendChild(camera);
                
                if (AFRAME.systems['mindar-image-system']) {
                    // –û–±—ä–µ–∫—Ç –¥–ª—è MindAR
                    const target = document.createElement('a-entity');
                    target.setAttribute('mindar-image-target', 'targetIndex: 0');
                    
                    const object = document.createElement('a-box');
                    object.setAttribute('position', '0 0 0');
                    object.setAttribute('color', '#00ff00');
                    object.setAttribute('scale', '0.2 0.2 0.2');
                    object.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 10000');
                    
                    target.appendChild(object);
                    scene.appendChild(target);
                } else {
                    // Fallback –æ–±—ä–µ–∫—Ç
                    const object = document.createElement('a-box');
                    object.setAttribute('position', '0 0 -2');
                    object.setAttribute('color', '#ff0000');
                    object.setAttribute('scale', '0.5 0.5 0.5');
                    object.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 8000');
                    scene.appendChild(object);
                    
                    const text = document.createElement('a-text');
                    text.setAttribute('value', 'AR Fallback Mode');
                    text.setAttribute('position', '0 1 -2');
                    text.setAttribute('color', '#0f0');
                    text.setAttribute('align', 'center');
                    scene.appendChild(text);
                }
                
                // –û—Å–≤–µ—â–µ–Ω–∏–µ
                const light1 = document.createElement('a-light');
                light1.setAttribute('type', 'ambient');
                light1.setAttribute('color', '#fff');
                light1.setAttribute('intensity', '0.6');
                scene.appendChild(light1);
                
                const light2 = document.createElement('a-light');
                light2.setAttribute('type', 'directional');
                light2.setAttribute('position', '1 1 1');
                light2.setAttribute('intensity', '0.4');
                scene.appendChild(light2);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ü–µ–Ω—É
                document.getElementById('ar-container').appendChild(scene);
                
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω—ã
                scene.addEventListener('loaded', function() {
                    console.log("‚úÖ Scene loaded");
                    
                    if (AFRAME.systems['mindar-image-system']) {
                        // –ó–∞–ø—É—Å–∫–∞–µ–º MindAR
                        const mindarSystem = scene.systems['mindar-image-system'];
                        if (mindarSystem) {
                            mindarSystem.start();
                            showSuccess("AR system started with MindAR!");
                        }
                    } else {
                        showSuccess("Running in fallback 3D mode");
                    }
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º loader
                    setTimeout(() => {
                        document.getElementById('loader').style.display = 'none';
                    }, 1000);
                });
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
                scene.addEventListener('arError', function(e) {
                    console.error("AR Error:", e.detail.error);
                    showError("AR Error: " + e.detail.error);
                });
                
            } catch (error) {
                console.error("Scene creation error:", error);
                showError("Failed to create scene: " + error.message);
                document.getElementById('start-btn').disabled = false;
                document.getElementById('start-btn').textContent = 'üîÑ RETRY';
            }
        }
        
        function showError(message) {
            console.error(message);
            document.getElementById('error').innerHTML = message;
            document.getElementById('error').style.display = 'block';
            document.getElementById('main-status').textContent = '>>> ERROR';
            document.getElementById('main-status').style.color = '#f00';
        }
        
        function showSuccess(message) {
            console.log(message);
            document.getElementById('success').innerHTML = message;
            document.getElementById('success').style.display = 'block';
            document.getElementById('main-status').textContent = '>>> SUCCESS';
            document.getElementById('main-status').style.color = '#0f0';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Å–æ–ª–∏
        setInterval(() => {
            const statusElements = document.querySelectorAll('.status-line');
            const statusText = Array.from(statusElements)
                .map(el => el.textContent)
                .join(' | ');
            document.getElementById('console-status').textContent = statusText.substring(0, 50) + '...';
        }, 1000);
    </script>
</body>
</html>